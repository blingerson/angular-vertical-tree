angular.module("drg.angularVerticalTree",[]).directive("verticalTree",["$templateCache","$timeout",function(e,r){return{restrict:"EA",scope:!0,controller:"vTreeCtrl",compile:function(t,l){var n=t.find("vertical-tree-breadcrumb"),a=t.find("vertical-tree-leaf"),c=l.treeItems,s=l.treeOpts;return n=n&&n.length>0?n.html():"",a=a&&a.length>0?a.html():"",t.html(e.get("drg/angularVerticalTree.tpl.html")),{pre:function(r){r.vTreeTemplates={breadcrumb:"drg/vTreeBreadcrumb"+r.$id+".tpl.html",leaf:"drg/vTreeLeaf"+r.$id+".tpl.html"},r.vTreeExpr={items:c||"[]",opts:s||"{}",open:null,select:null},e.put(r.vTreeTemplates.breadcrumb,n),e.put(r.vTreeTemplates.leaf,a),r.$watch(function(){return l.treeItems},function(e){r.vTreeExpr.items=e||"[]"}),r.$watch(function(){return l.treeOpts},function(e){r.vTreeExpr.opts=e||"{}"}),r.$watch(function(){return l.onOpen},function(e){r.vTreeExpr.open=e||null}),r.$watch(function(){return l.onSelect},function(e){r.vTreeExpr.select=e||null})},post:function(e,t,l){e.vTreeCtrl.render=function(){r(function(){var e=t.children().eq(0),r=e.children().eq(0),l=e.children().eq(1);l.css("height","calc(100% - "+r.height()+"px)")})}}}}}}]).controller("vTreeCtrl",["$scope","$timeout",function(e,r){function t(r){e.vTreeCtrl.breadcrumbs.push(r),e.vTreeCtrl.currentItems=r[e.vTreeCtrl.opts.children],e.vTreeCtrl.render(),e.$emit("verticalTree.openFolder",r),e.vTreeExpr.open&&e.$eval(e.vTreeExpr.open)(r)}function l(r){e.$emit("verticalTree.selectItem",r),e.vTreeExpr.select&&e.$eval(e.vTreeExpr.select)(r)}var n={root:"Root",label:"label",children:"children",classes:{container:"panel panel-default",breadcrumbs:"panel-heading",breadcrumb:"panel-title",branch:"list-group",leaf:"list-group-item"},isLeaf:function(){return!0},isFolder:function(r){return r[e.vTreeCtrl.opts.children]&&r[e.vTreeCtrl.opts.children].length>0}};e.vTreeCtrl={get opts(){return angular.extend(angular.copy(n),e.$eval(e.vTreeExpr.opts)||{})},breadcrumbs:[],get items(){return e.$eval(e.vTreeExpr.items)||[]},currentItems:[],get leaves(){var r=[];return angular.forEach(e.vTreeCtrl.currentItems,function(t){e.vTreeCtrl.opts.isLeaf(t)&&r.push(t)}),r},leafClickHandler:function(r){e.vTreeCtrl.opts.isFolder(r)?t(r):e.vTreeCtrl.opts.isLeaf(r)&&l(r)},breadcrumbClickHandler:function(r){for(var l=0;l<e.vTreeCtrl.breadcrumbs.length;l++)if(angular.equals(e.vTreeCtrl.breadcrumbs[l],r)){e.vTreeCtrl.breadcrumbs.splice(l,e.vTreeCtrl.breadcrumbs.length-l),t(r);break}}},r(function(){var r={};angular.isObject(e.vTreeCtrl.opts.root)?r=angular.copy(e.vTreeCtrl.opts.root):r[e.vTreeCtrl.opts.label]=e.vTreeCtrl.opts.root,Object.defineProperty(r,e.vTreeCtrl.opts.children,{get:function(){return e.vTreeCtrl.items}}),e.vTreeCtrl.breadcrumbs.push(r),e.vTreeCtrl.currentItems=e.vTreeCtrl.items})}]),angular.module("drg.angularVerticalTree").run(["$templateCache",function(e){e.put("drg/angularVerticalTree.tpl.html",'<div class="v-tree-container" ng-class="vTreeCtrl.opts.classes.container">\n    <div class="v-tree-breadcrumbs" ng-class="vTreeCtrl.opts.classes.breadcrumbs">\n        <div class="v-tree-breadcrumb" ng-class="vTreeCtrl.opts.classes.breadcrumb" ng-repeat="breadcrumb in vTreeCtrl.breadcrumbs">\n            <a href="javascript:;" ng-click="vTreeCtrl.breadcrumbClickHandler(breadcrumb)" ng-include="vTreeTemplates.breadcrumb"></a>\n        </div>\n    </div>\n    <ul class="v-tree-branch" ng-class="vTreeCtrl.opts.classes.branch">\n        <li class="v-tree-leaf" ng-class="vTreeCtrl.opts.classes.leaf" ng-repeat="leaf in vTreeCtrl.leaves">\n            <a href="javascript:;" ng-click="vTreeCtrl.leafClickHandler(leaf)" ng-include="vTreeTemplates.leaf"></a>\n        </li>\n    </ul>\n</div>\n')}]);