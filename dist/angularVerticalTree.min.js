angular.module("drg.angularVerticalTree",[]).directive("verticalTree",["$templateCache","$timeout",function(e,r){return{restrict:"EA",scope:!0,controller:"vTreeCtrl",compile:function(t,n){var l=t.find("vertical-tree-breadcrumb"),a=t.find("vertical-tree-leaf"),c=n.treeItems,u=n.treeOpts;return l=l&&l.length>0?l.html():"",a=a&&a.length>0?a.html():"",t.html(e.get("drg/angularVerticalTree.tpl.html")),{pre:function(r){r.vTreeTemplates={breadcrumb:"drg/vTreeBreadcrumb"+r.$id+".tpl.html",leaf:"drg/vTreeLeaf"+r.$id+".tpl.html"},r.vTreeExpr={items:c||"[]",opts:u||"{}",open:null,select:null},e.put(r.vTreeTemplates.breadcrumb,l),e.put(r.vTreeTemplates.leaf,a),r.$watch(function(){return n.treeItems},function(e){r.vTreeExpr.items=e||"[]"}),r.$watch(function(){return n.treeOpts},function(e){r.vTreeExpr.opts=e||"{}"}),r.$watch(function(){return n.onOpen},function(e){r.vTreeExpr.open=e||null}),r.$watch(function(){return n.onSelect},function(e){r.vTreeExpr.select=e||null})},post:function(e,t,n){function l(){r(function(){var e=t.children().eq(0),r=e.find(".v-tree-breadcrumb"),n=0;r.each(function(){n+=$(this).outerHeight()});var l=e.find(".v-tree-branch");l.css("height","calc(100% - "+n+"px)")})}l(),e.vTreeCtrl.updateBranchHeight=l}}}}}]).controller("vTreeCtrl",["$scope","$timeout",function(e,r){function t(r){e.vTreeCtrl.breadcrumbs.push(r),e.vTreeCtrl.currentItems=r[e.vTreeCtrl.opts.children],e.vTreeCtrl.updateBranchHeight(),e.$emit("verticalTree.openFolder",r),e.vTreeExpr.open&&e.$eval(e.vTreeExpr.open)(r)}function n(r){e.$emit("verticalTree.selectItem",r),e.vTreeExpr.select&&e.$eval(e.vTreeExpr.select)(r)}var l={root:"Root",label:"label",children:"children",classes:{container:"panel panel-default",breadcrumb:"panel-heading",branch:"list-group",leaf:"list-group-item"},isLeaf:function(){return!0},isFolder:function(r){return r[e.vTreeCtrl.opts.children]&&r[e.vTreeCtrl.opts.children].length>0}};e.vTreeCtrl={get opts(){return angular.extend(angular.copy(l),e.$eval(e.vTreeExpr.opts)||{})},breadcrumbs:[],get items(){return e.$eval(e.vTreeExpr.items)||[]},currentItems:[],get leaves(){var r=[];return angular.forEach(e.vTreeCtrl.currentItems,function(t){e.vTreeCtrl.opts.isLeaf(t)&&r.push(t)}),r},leafClickHandler:function(r){e.vTreeCtrl.opts.isFolder(r)?t(r):e.vTreeCtrl.opts.isLeaf(r)&&n(r)},breadcrumbClickHandler:function(r){for(var n=0;n<e.vTreeCtrl.breadcrumbs.length;n++)if(angular.equals(e.vTreeCtrl.breadcrumbs[n],r)){e.vTreeCtrl.breadcrumbs.splice(n,e.vTreeCtrl.breadcrumbs.length-n),t(r);break}}},r(function(){var r={};angular.isObject(e.vTreeCtrl.opts.root)?r=angular.copy(e.vTreeCtrl.opts.root):r[e.vTreeCtrl.opts.label]=e.vTreeCtrl.opts.root,Object.defineProperty(r,e.vTreeCtrl.opts.children,{get:function(){return e.vTreeCtrl.items}}),e.vTreeCtrl.breadcrumbs.push(r),e.vTreeCtrl.currentItems=e.vTreeCtrl.items})}]),angular.module("drg.angularVerticalTree").run(["$templateCache",function(e){e.put("drg/angularVerticalTree.tpl.html",'<!-- .panel by default -->\n<div class="v-tree-container" ng-class="vTreeCtrl.opts.classes.container">\n\n    <!-- .panel-heading by default -->\n    <a class="v-tree-breadcrumb"\n       href="javascript:;"\n       ng-class="vTreeCtrl.opts.classes.breadcrumb"\n       ng-click="vTreeCtrl.breadcrumbClickHandler(breadcrumb)"\n       ng-include="vTreeTemplates.breadcrumb"\n       ng-repeat="breadcrumb in vTreeCtrl.breadcrumbs"\n       style="display: block; text-decoration: none;">\n    </a>\n\n    <!-- .list-group by default -->\n    <div class="v-tree-branch" ng-class="vTreeCtrl.opts.classes.branch">\n        <!-- .list-group-item by default -->\n        <a class="v-tree-leaf"\n           href="javascript:;"\n           ng-class="vTreeCtrl.opts.classes.leaf"\n           ng-click="vTreeCtrl.leafClickHandler(leaf)"\n           ng-include="vTreeTemplates.leaf"\n           ng-repeat="leaf in vTreeCtrl.leaves">\n        </a>\n    </div>\n\n</div>\n')}]);